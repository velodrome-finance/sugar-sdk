# Sugar SDK


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Using Sugar

``` bash
pip install git+https://github.com/velodrome-finance/sugar-sdk
```

**TODO**: push to pypi

``` python
# load env
from dotenv import load_dotenv
load_dotenv()
```

    True

## Base quickstart

``` python
from sugar.chains import BaseChain, AsyncBaseChain

# async version
async with AsyncBaseChain() as chain:
    prices = await chain.get_prices(await chain.get_all_tokens())
    for p in prices[:5]:
        print(f"{p.token.symbol} price: {p.price}")

# sync version
with BaseChain() as chain:
    for p in chain.get_prices(chain.get_all_tokens())[:5]:
        print(f"{p.token.symbol} price: {p.price}")
```

    ETH price: 1768.296199950167
    tBTC price: 93360.67688341912
    USDbC price: 1.0093169584081934
    WETH price: 1768.296199950167
    T price: 0.017533047336501028
    ETH price: 1768.296375339803
    tBTC price: 93360.68614346001
    USDbC price: 1.0093169907685393
    WETH price: 1768.296375339803
    T price: 0.01753304732841051

## OP quickstart

``` python
from sugar.chains import AsyncOPChain, OPChain

async with AsyncOPChain() as chain:
    prices = await chain.get_prices(await chain.get_all_tokens())
    for p in prices[:5]:
        print(f"{p.token.symbol} price: {p.price}")

with OPChain() as chain:
    for p in chain.get_prices(chain.get_all_tokens())[:5]:
        print(f"{p.token.symbol} price: {p.price}")
```

    ETH price: 1744.4492427207376
    VELO price: 0.05062317692743053
    RED price: 0.08773882884393253
    USDC price: 1.0
    WETH price: 1744.4492427207376
    ETH price: 1744.4492427207376
    VELO price: 0.05062317692743053
    RED price: 0.08773882884393253
    USDC price: 1.0
    WETH price: 1744.4492427207376

## Pools

``` python
from sugar.chains import AsyncOPChain, OPChain

async with AsyncOPChain() as chain:
    pools = await chain.get_pools()
    usdc_velo = next(iter([p for p in pools if p.token0.token_address == OPChain.usdc and p.token1.token_address == OPChain.velo]), None)
    print(f"{usdc_velo.symbol}")
    print("-----------------------")
    print(f"Volume: {usdc_velo.token0_volume} {usdc_velo.token0.symbol} | {usdc_velo.token1_volume} {usdc_velo.token1.symbol} | ${usdc_velo.volume}")
    print(f"Fees: {usdc_velo.token0_fees.amount} {usdc_velo.token0.symbol} | {usdc_velo.token1_fees.amount} {usdc_velo.token1.symbol} | ${usdc_velo.total_fees}")
    print(f"TVL: {usdc_velo.reserve0.amount} {usdc_velo.token0.symbol} | {usdc_velo.reserve1.amount} {usdc_velo.token1.symbol} | ${usdc_velo.tvl}")
    print(f"APR: {usdc_velo.apr}%")

with OPChain() as chain:
    pools = chain.get_pools()
    usdc_velo = next(iter([p for p in pools if p.token0.token_address == OPChain.usdc and p.token1.token_address == OPChain.velo]), None)
    print(f"{usdc_velo.symbol}")
    print("-----------------------")
    print(f"Volume: {usdc_velo.token0_volume} {usdc_velo.token0.symbol} | {usdc_velo.token1_volume} {usdc_velo.token1.symbol} | ${usdc_velo.volume}")
    print(f"Fees: {usdc_velo.token0_fees.amount} {usdc_velo.token0.symbol} | {usdc_velo.token1_fees.amount} {usdc_velo.token1.symbol} | ${usdc_velo.total_fees}")
    print(f"TVL: {usdc_velo.reserve0.amount} {usdc_velo.token0.symbol} | {usdc_velo.reserve1.amount} {usdc_velo.token1.symbol} | ${usdc_velo.tvl}")
    print(f"APR: {usdc_velo.apr}%")
```

    vAMM-USDC/VELO
    -----------------------
    Volume: 33002.43411111111 USDC | 1171963.9049981958 VELO | $92316.04750086606
    Fees: 297.021907 USDC | 10547.675144983761 VELO | $830.8444275077945
    TVL: 1925694.554074 USDC | 38054890.00589409 VELO | $3851283.241620407
    APR: 18.69648738123409%
    vAMM-USDC/VELO
    -----------------------
    Volume: 33002.43411111111 USDC | 1171963.9049981958 VELO | $92316.04750086606
    Fees: 297.021907 USDC | 10547.675144983761 VELO | $830.8444275077945
    TVL: 1925694.554074 USDC | 38054890.00589409 VELO | $3851283.241620407
    APR: 18.69648738123409%

## Swaps

Get a quote and swap:

``` python
from sugar.chains import AsyncBaseChain

async with AsyncBaseChain() as chain:
    tokens = await chains.get_all_tokens(listed_only=True)
    def get_token_by_address(addr): return next(filter(lambda t: t.token_address == addr, tokens), None)
    velo = get_token_by_address(normalize_address("0x9560e827af36c94d2ac33a39bce1fe78631088db"))
    eth = get_token_by_address("ETH")
    quote = await op.get_quote(from_token=velo, to_token=eth, amount=10)
    # check on quote to see if you are OK with the amount
    await op.swap_from_quote(quote)
```

“I am Feeling lucky” swap:

``` python
from sugar.chains import AsyncBaseChain

async with AsyncBaseChain() as chain:
    tokens = await chains.get_all_tokens(listed_only=True)
    def get_token_by_address(addr): return next(filter(lambda t: t.token_address == addr, tokens), None)
    velo = get_token_by_address(normalize_address("0x9560e827af36c94d2ac33a39bce1fe78631088db"))
    eth = get_token_by_address("ETH")
    await op.swap(from_token=velo, to_token=eth, amount=10, slippage=0.01)
```

## Configuration

Full list of configuration parameters for Sugar. Chain IDs can be found
[here](https://chainlist.org/). Sugar uses decimal versions: Base is
`8453`, OP is `10`.

| config | env | default value |
|----|----|----|
| native_token_symbol |  | ETH |
| native_token_decimals |  | 18 |
| wrapped_native_token_addr | `SUGAR_WRAPPED_NATIVE_TOKEN_ADDR_<CHAIN_ID>` | chain specific |
| rpc_uri | `SUGAR_RPC_URI_<CHAIN_ID>` | chain specific |
| sugar_contract_addr | `SUGAR_CONTRACT_ADDR_<CHAIN_ID>` | chain specific |
| slipstream_contract_addr | `SUGAR_SLIPSTREAM_CONTRACT_ADDR_<CHAIN_ID>` | chain specific |
| nfpm_contract_addr | `SUGAR_NFPM_CONTRACT_ADDR` | chain specific |
| price_oracle_contract_addr | `SUGAR_PRICE_ORACLE_ADDR_<CHAIN_ID>` | chain specific |
| router_contract_addr | `SUGAR_ROUTER_CONTRACT_ADDR_<CHAIN_ID>` | chain specific |
| swapper_contract_addr | `SUGAR_ROUTER_SWAPPER_CONTRACT_ADDR_<CHAIN_ID>` | chain specific |
| token_addr | `SUGAR_TOKEN_ADDR_<CHAIN_ID>` | chain specific |
| stable_token_addr | `SUGAR_STABLE_TOKEN_ADDR_<CHAIN_ID>` | chain specific |
| connector_tokens_addrs | `SUGAR_CONNECTOR_TOKENS_ADDRS_<CHAIN_ID>` | chain specific |
| excluded_tokens_addrs | `SUGAR_EXCLUDED_TOKENS_ADDRS_<CHAIN_ID>` | chain specific |
| price_batch_size | `SUGAR_PRICE_BATCH_SIZE` | 40 |
| price_threshold_filter | `SUGAR_PRICE_THRESHOLD_FILTER` | 10 |
| pool_page_size | `SUGAR_POOL_PAGE_SIZE` | 500 |
| pagination_limit | `SUGAR_PAGINATION_LIMIT` | 2000 |

In order to write to Sugar contracts, you need to set your wallet
private key using env var `SUGAR_PK`

You can override specific settings in 2 ways:

- by setting corresponding env var: `SUGAR_RPC_URI_10=https://myrpc.com`
- in code:

``` python
from sugar.chains import OPChain

async with OPChain(rpc_uri="https://myrpc.com") as chain:
    ...
```

## Contributing to Sugar

### Set up and acivate python virtual env

``` bash
python3 -m venv env
source env/bin/activate
```

### Install dependencies

``` bash
pip install nbdev pre-commit
pip install -e '.[dev]'
```

### Install pre-commit hooks for nbdev prep and cleanup

``` bash
pre-commit install
```
